package rules

import tercerhombre.personaje.Personaje;
import tercerhombre.propiedades.*;
import tercerhombre.Buffer;

rule "martins va cementerio" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.CASALIME )
		
		b : Buffer()
	then

		modify(martins){
			setUbicacion(Ubicacion.CEMENTERIO);
		}
		
		modify(b){
			append("Martins va a"+martins.getUbicacion().toString()+". ");
		};
		
		insert(Personaje.nuevo().
    	setNombre(Personaje.calloway).
    	setGenero(Genero.HOMBRE).
    	setActividad(ActividadLegal.POLICIA).
    	setEstadoSalud(EstadoSalud.VIVO).
    	setNacionalidad(Nacionalidad.GRANBRETANA).
    	setUbicacion(Ubicacion.CEMENTERIO));
		

end

rule "martins conoce calloway" agenda-group "g1"
no-loop true
    when
        martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.CEMENTERIO  )
        calloway : Personaje( nombre == Personaje.calloway, ubicacion == Ubicacion.CEMENTERIO  )
        
        b : Buffer()
    then
        
        modify(martins){
		   getConoce_a().add(calloway);
		};
		modify(calloway){
		   getConoce_a().add(martins);
		};

        modify(b){
			append("Martins conoce a "+Personaje.calloway+". ").
			append("Calloway conoce a "+Personaje.martins+". ");
		};
end 

rule "van al pub" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.CEMENTERIO  )
        calloway : Personaje( nombre == Personaje.calloway, ubicacion == Ubicacion.CEMENTERIO  )
        
        Personaje( nombre == Personaje.martins ) from calloway.conoce_a
        Personaje( nombre == Personaje.calloway ) from martins.conoce_a
        
        b : Buffer()
	then
        
        modify(martins){
		   setUbicacion(Ubicacion.PUB);
		};
		modify(calloway){
		   setUbicacion(Ubicacion.PUB);
		};

        modify(b){
			append("Martins va a"+martins.getUbicacion().toString()+". ").
			append("Calloway va a"+calloway.getUbicacion().toString()+". ");
		};
		
		insert(Personaje.nuevo().
    	setNombre(Personaje.paine).
    	setGenero(Genero.HOMBRE).
    	setActividad(ActividadLegal.POLICIA).
    	setEstadoSalud(EstadoSalud.VIVO).
    	setNacionalidad(Nacionalidad.GRANBRETANA).
    	setUbicacion(Ubicacion.PUB));
end

rule "martins conoce a paine" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.PUB )
		paine : Personaje( nombre == Personaje.paine, ubicacion == Ubicacion.PUB )
		calloway : Personaje( nombre == Personaje.calloway)
		
		b : Buffer()
		
	then
		
		modify(paine){
		   getConoce_a().add(martins);
		};
		modify(paine){
		   getConoce_a().add(calloway);
		};
		modify(paine){
		   getTrabaja_con().add(calloway);
		};
		modify(calloway){
		   getConoce_a().add(paine);
		};
		modify(calloway){
		   getTrabaja_con().add(paine);
		};
		modify(martins){
		   getConoce_a().add(paine);
		};
		
		modify(b){
			append("Martins conoce a "+Personaje.paine+". ").
	        append("Calloway conoce a "+Personaje.paine+". ").
	        append("Paine conoce a "+Personaje.calloway+". ").
	        append("Paine conoce a "+Personaje.martins+". ").
	        append("Paine trabaja con "+Personaje.calloway+". ").
	        append("Calloway trabaja con "+Personaje.paine+". ");
		};
	

end

rule "martins va a hotel" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.PUB )
		
		b : Buffer()
	then
		
		modify(martins){
		   setUbicacion(Ubicacion.HOTELSACHER);
		};
		
		modify(b){
			append("Martins va a"+martins.getUbicacion().toString()+". ");
		};
		
		insert(Personaje.nuevo().
		setNombre(Personaje.crabbin).
		setGenero(Genero.HOMBRE).
		setActividad(ActividadLegal.DIRECTIVO).
		setEstadoSalud(EstadoSalud.VIVO).
		setNacionalidad(Nacionalidad.GRANBRETANA).
		setUbicacion(Ubicacion.HOTELSACHER));
end

rule "martins conoce crabbin" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.HOTELSACHER )
		crabbin : Personaje( nombre == Personaje.crabbin, ubicacion == Ubicacion.HOTELSACHER )
		
		b : Buffer()
	then
		
		modify(martins){
		   getConoce_a().add(crabbin);
		};
		
		modify(crabbin){
		   getConoce_a().add(martins);
		};
		
        modify(b){
			append("Martins conoce a "+Personaje.crabbin+". ").
			append("Crabbin conoce a "+Personaje.martins+". ");
		};
end

rule "martins va cafe mozart" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.HOTELSACHER )
		crabbin : Personaje( nombre == Personaje.crabbin )
		
		Personaje( nombre == Personaje.martins ) from crabbin.conoce_a
        Personaje( nombre == Personaje.crabbin ) from martins.conoce_a
        
        b : Buffer()
	then
		
		modify(martins){
		   setUbicacion(Ubicacion.CAFEMOZART);
		};
		
		
		modify(b){
			append("Martins va a"+martins.getUbicacion().toString()+". ");
		};
		
		insert(Personaje.nuevo().
     	setNombre(Personaje.kurtz).
     	setGenero(Genero.HOMBRE).
     	setActividad(null).
     	setEstadoSalud(EstadoSalud.VIVO).
     	setNacionalidad(Nacionalidad.AUSTRIA).
     	setUbicacion(Ubicacion.CAFEMOZART));
     	

end

rule "martins conoce kurtz" agenda-group "g1"
no-loop true
	when
		martins : Personaje( nombre == Personaje.martins, ubicacion == Ubicacion.CAFEMOZART )
		kurtz : Personaje( nombre == Personaje.kurtz, ubicacion == Ubicacion.CAFEMOZART )
		lime : Personaje( nombre == Personaje.lime)
		
		b : Buffer()
		
	then
	
		modify(martins){
		   getConoce_a().add(kurtz);
		};
		
		modify(kurtz){
		   getConoce_a().add(martins);
		};
		
		modify(kurtz){
		   getConoce_a().add(lime);
		};
		
		modify(kurtz){
		   getAmigo_de().add(lime);
		};
		
		modify(lime){
		   getConoce_a().add(kurtz);
		};
		
		modify(lime){
		   getAmigo_de().add(kurtz);
		};
		
		modify(b){
			append("Martins conoce a "+Personaje.kurtz+". ").
	        append("Kurtz conoce a "+Personaje.martins+". ").
	        append("Kurtz conoce a "+Personaje.lime+". ").
	        append("Kurtz es amigo de "+Personaje.lime+". ").
	        append("Lime conoce a "+Personaje.kurtz+". ").
	        append("Lime es amigo de "+Personaje.kurtz+". ");
		};
		
		
end